<html>
    <head>
        <title>Vanilla</title>
        <script src="/assets/dist/adapters.web.vanilla.bundle.js"></script>
        <script src="/assets/dist/mock.application.bundle.js"></script>
        <script src="/assets/dist/real.bundle.js"></script>
        <link rel="stylesheet" type="text/css" href="/assets/css/default.css" />
        <style>
            html, body {
              margin: 0;
              padding: 0;
            }
          </style>
    </head>
    <body></body>
    <script>
        var toggles     = new real.QueryStringToggles(document.location.search);
        var settings    = new real.QueryStringSettings(document.location.search);

        var view        = new real.UIEvents();
        var application = toggles.get('unplug') ? new mock.Application(toggles, settings) : real.application(toggles, settings);
        
        application.pollEvery(parseInt(settings.get('polling-frequency','600000')));

        let title;

        view.onRender(e => console.log(`[render] ${JSON.stringify(e)}`));

        const addScript = src => {
            const scriptTag = document.createElement('script');
            scriptTag.setAttribute('src'    , src);
            document.body.appendChild(scriptTag);
        }

        const addCss = src => {
            const linkTag = document.createElement('link');
            linkTag.setAttribute('href', src);
            linkTag.setAttribute('rel', 'stylesheet');
            linkTag.setAttribute('type', 'text/css');
            document.head.appendChild(linkTag);
        }

        var start = async () => {
            const applicationNode = document.querySelector('#application');
            
            console.log(`[start] node => <${document.querySelector('#application')}>`);

            if (applicationNode) {
                document.body.removeChild(applicationNode);
            }

            if (window.toggles.get('use-svelte')) {
                addScript('/assets/dist/svelte.bundle.js');
                document.title += " -- Svelte";
            }
            else if (window.toggles.get('use-svelte-smui')) {
                addCss('/assets/dist/adapters.web.svelte-smui.css');
                addScript('/assets/dist/adapters.web.svelte-smui.bundle.js');
                document.title += " -- Svelte SMUI";
            } 
            else if (window.toggles.get('use-vue')) {
                addScript('/assets/dist/adapters.web.vue.bundle.js');
                document.title += " -- Vue.js";
            }
            else if (window.toggles.get('use-react')) {
                const div = document.createElement('div');
                div.setAttribute('id', 'application');
                document.body.appendChild(div);
                addScript('/assets/dist/adapters.web.react.bundle.js');
                document.title += " -- React";
            }
            else
            {
                vanilla.render(document, application);
            }
            title = new real.Title(application, document);
        }

        if (! toggles.get('unplug')) {
          const sync = new real.SocketSync(`ws://${document.location.hostname}:1080`, console.log);
          sync.connect(window.application);
      }
    </script>
    <script>
        if (!toggles.get('disallow-autostart')) {
            start();
        }
    </script>
</html>